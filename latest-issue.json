[{"body":"\n## Description of the Error\n\nA common issue when using Next.js Middleware with `next/navigation`'s client-side routing functions (like `useRouter.push`, `useRouter.replace`, etc.) is encountering errors, particularly in `GET` requests.  Middleware runs on the server during the request phase, before the page's component is rendered.  Client-side navigation APIs are designed for browser-side manipulation after the page has loaded.  Attempting to directly call these within middleware intended for a `GET` request often leads to errors because the browser context isn't available.  The middleware will throw errors and fail to correctly redirect or manipulate navigation.\n\n\n## Code Example: The Problem\n\nLet's say you're trying to redirect unauthenticated users to the login page using middleware:\n\n```javascript\n// pages/api/middleware.js\nimport { NextResponse } from 'next/server'\nimport { useRouter } from 'next/router' // INCORRECT usage here\n\nexport function middleware(req) {\n  const router = useRouter() // This will throw an error\n  if (!req.cookies.get('auth_token')) {\n    router.push('/login') // This will FAIL in Middleware GET Request.\n    return NextResponse.redirect(new URL('/login', req.url))\n  }\n}\n\nexport const config = {\n  matcher: '/',\n}\n```\n\n\n## Step-by-Step Fix\n\nThe solution is to avoid client-side navigation functions like `useRouter` entirely within the middleware.  Instead, leverage `NextResponse.redirect` to handle server-side redirects:\n\n\n```javascript\n// pages/api/middleware.js\nimport { NextResponse } from 'next/server'\n\nexport function middleware(req) {\n  if (!req.cookies.get('auth_token')) {\n    // Correctly redirect using NextResponse\n    return NextResponse.redirect(new URL('/login', req.url));\n  }\n}\n\nexport const config = {\n  matcher: '/',\n}\n```\n\nThis corrected version uses `NextResponse.redirect` which is a server-side function, properly manipulating the response to redirect the user before the client even receives the initial HTML.\n\n\n## Explanation\n\nThe core difference lies in the execution context.  `useRouter` is a React Hook, designed to be used *within* a React component *on the client-side*.  Middleware, on the other hand, runs on the server *before* the React component is rendered.  Using `useRouter` in the middleware tries to access the client-side context prematurely, causing an error.  `NextResponse` operates entirely within the server-side context of the request and response cycle, making it the correct tool for redirecting within middleware.\n\n\n## External References\n\n* [Next.js Middleware Documentation](https://nextjs.org/docs/app/building-your-application/routing/middleware)\n* [NextResponse API Reference](https://nextjs.org/docs/api-reference/next/server#nextresponse)\n* [Next.js Cookies](https://nextjs.org/docs/app/building-your-application/data-fetching/cookies) (for cookie handling examples)\n\n\nCopyrights (c) OpenRockets Open-source Network. Free to use, copy, share, edit or publish.\n","number":1069,"title":"Next.js Middleware: Handling `next/navigation` in `GET` requests"}]
