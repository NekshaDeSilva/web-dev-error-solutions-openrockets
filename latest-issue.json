[{"body":"\nThis document addresses a common problem encountered when developing Next.js applications that interact with external APIs: **CORS (Cross-Origin Resource Sharing) errors**.\n\n**Description of the Error:**\n\nA CORS error occurs when a web page (e.g., your Next.js application running on `http://localhost:3000`) makes a request to a different origin (e.g., an API server running on `https://api.example.com`).  Browsers implement the same-origin policy for security reasons, preventing requests from one origin to another unless the server explicitly allows it.  This results in an error message similar to:\n\n```\nAccess to XMLHttpRequest at 'https://api.example.com/data' from origin 'http://localhost:3000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n```\n\n\n**Step-by-Step Code Fix:**\n\nThe solution involves configuring the API server (not the Next.js frontend) to allow requests from your Next.js application's origin.  Since we don't have access to the API server's code here, we will demonstrate how to handle this assuming the API is built with Node.js and Express.js.\n\n**1. API Server (Node.js with Express.js):**\n\nLet's say your API server's code looks like this (without CORS handling):\n\n```javascript\n// api-server.js\nconst express = require('express');\nconst app = express();\nconst port = 3001;\n\napp.get('/data', (req, res) => {\n  res.json({ message: 'Hello from API!' });\n});\n\napp.listen(port, () => {\n  console.log(`API server listening on port ${port}`);\n});\n```\n\n**2. Adding CORS Middleware:**\n\nWe'll use the `cors` middleware package to handle CORS.  First, install it:\n\n```bash\nnpm install cors\n```\n\nThen, modify your API server code:\n\n```javascript\n// api-server.js\nconst express = require('express');\nconst cors = require('cors'); // Import cors\nconst app = express();\nconst port = 3001;\n\n// Add this line to enable CORS\napp.use(cors({\n    origin: 'http://localhost:3000' // Allow requests from your Next.js app\n}));\n\napp.get('/data', (req, res) => {\n  res.json({ message: 'Hello from API!' });\n});\n\napp.listen(port, () => {\n  console.log(`API server listening on port ${port}`);\n});\n```\n\nThis allows requests from `http://localhost:3000`.  For a production environment, you would replace this with your actual domain.  You can also use `origin: '*'` to allow requests from all origins (less secure, generally avoided in production).\n\n**3. Next.js Frontend (Fetching Data):**\n\nHere's an example of fetching data from the API in your Next.js application:\n\n```javascript\n// pages/index.js\nimport { useEffect, useState } from 'react';\n\nexport default function Home() {\n  const [data, setData] = useState(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const response = await fetch('http://localhost:3001/data');\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const jsonData = await response.json();\n        setData(jsonData);\n      } catch (error) {\n        console.error('Error fetching data:', error);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  return (\n    <div>\n      {data ? <pre>{JSON.stringify(data, null, 2)}</pre> : <p>Loading...</p>}\n    </div>\n  );\n}\n```\n\n\n**Explanation:**\n\nThe `cors` middleware in Express.js adds the necessary `Access-Control-Allow-Origin` header to the API's response, telling the browser it's safe to allow the request from the specified origin.  The Next.js code uses `fetch` to make the request to the API.  Error handling is included to manage potential issues during the fetch process.\n\n\n**External References:**\n\n* [CORS Wikipedia](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing)\n* [Express.js CORS Middleware](https://www.npmjs.com/package/cors)\n* [Next.js Documentation](https://nextjs.org/docs)\n\n\nCopyrights (c) OpenRockets Open-source Network. Free to use, copy, share, edit or publish.\n","number":124,"title":"Handling CORS Errors in a Next.js Application"}]
