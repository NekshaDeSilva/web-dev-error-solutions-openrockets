[{"body":"\nThis document addresses a common issue developers encounter when working with Next.js Middleware: importing modules from `next/server`.  This error typically occurs when attempting to use `next/server` APIs within a file that is also accessible in the client-side environment.\n\n**Description of the Error:**\n\nYou might encounter a build-time or runtime error similar to:\n\n```\nError: Cannot find module 'next/server' or its corresponding type declarations.\n```\n\nThis indicates that you're trying to use server-side-only modules (like those from `next/server`) in a context where Next.js attempts to bundle them for the client.  This is usually because the file is imported or rendered in a client-side context, even if intended for middleware.\n\n**Code Example & Step-by-Step Fix:**\n\nLet's say you have a middleware file (`middleware.js`) trying to use `NextResponse` from `next/server`:\n\n**Incorrect Code (middleware.js):**\n\n```javascript\n// middleware.js (INCORRECT)\nimport { NextResponse } from 'next/server';\n\nexport function middleware(req) {\n  const url = req.nextUrl.clone();\n  url.pathname = '/new-page';\n  return NextResponse.rewrite(url);\n}\n```\n\nThis code *appears* correct, but the issue might arise if this `middleware.js` file is accidentally imported somewhere else in the application, for instance, in a client component.\n\n**Correct Code (middleware.js):**\n\n```javascript\n// middleware.js (CORRECT)\nimport { NextResponse } from 'next/server';\n\nexport function middleware(req) {\n  const url = req.nextUrl.clone();\n  url.pathname = '/new-page';\n  return NextResponse.rewrite(url);\n}\n\nexport const config = {\n  matcher: ['/page1', '/page2'], // Define which paths this middleware should apply to.\n};\n```\n\n**Explanation:**\n\nThe key here is the `config` export. This explicitly tells Next.js that this file is middleware and limits its scope to server-side execution only.  The `matcher` property defines the routes the middleware will affect. Without this `config` export, Next.js might try to bundle the file for client-side execution, leading to the import error.\n\n**External References:**\n\n* [Next.js Middleware Documentation](https://nextjs.org/docs/app/building-your-application/routing/middleware):  The official Next.js documentation on Middleware.  This is crucial for understanding the nuances of middleware usage.\n* [Next.js API Routes Documentation](https://nextjs.org/docs/api-routes/introduction): While not directly related to this specific error, understanding API routes helps contrast with middleware functionality.\n\n\n**Further Considerations:**\n\n* **Accidental Imports:** Carefully review all your imports to ensure that `middleware.js` (or similar middleware files) are *not* imported into any client components or pages.\n* **File Naming:** While not a direct cause, using descriptive filenames (like `middleware.js` or `my-middleware.js`) can improve readability and reduce accidental misuses.\n* **Testing:** Thoroughly test your middleware to ensure it functions as intended and doesn't inadvertently cause client-side errors.\n\n\nCopyrights (c) OpenRockets Open-source Network. Free to use, copy, share, edit or publish.\n","number":943,"title":"Next.js Middleware: Handling `next/server` Import Errors"}]
