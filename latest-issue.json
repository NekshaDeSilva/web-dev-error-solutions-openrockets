[{"body":"\nThis document addresses a common error encountered when using Next.js Middleware: `Error: Only absolute URLs are supported`. This error typically arises when attempting to redirect or rewrite requests using relative URLs within your middleware function.  Middleware operates at a lower level than the client-side rendering context, meaning relative paths aren't interpreted correctly against the application's base URL.\n\n## Description of the Error\n\nThe `Error: Only absolute URLs are supported` in Next.js Middleware indicates that you've used a URL path that's relative to the current request path, instead of an absolute URL that's relative to the entire application's domain. This often manifests when redirecting users based on authentication status, route-specific logic, or dynamically generated content paths.\n\n## Code Example & Step-by-Step Fix\n\nLet's say you have a middleware function that attempts to redirect users to `/profile` if they're not logged in:\n\n**Problematic Code:**\n\n```javascript\n// pages/api/middleware.js\nimport { NextResponse } from 'next/server'\n\nexport function middleware(req) {\n  const isLoggedIn = false; // Replace with your actual authentication check\n\n  if (!isLoggedIn) {\n    return NextResponse.redirect('/profile'); // This will throw the error\n  }\n}\n\nexport const config = {\n  matcher: ['/'], // Match all routes\n}\n```\n\n**Corrected Code:**\n\nTo fix this, we need to use an absolute URL.  We achieve this by constructing the URL using the `Request` object's `nextUrl` property:\n\n```javascript\n// pages/api/middleware.js\nimport { NextResponse } from 'next/server'\n\nexport function middleware(req) {\n  const isLoggedIn = false; // Replace with your actual authentication check\n\n  if (!isLoggedIn) {\n    const res = NextResponse.redirect(new URL('/profile', req.url));\n    return res;\n  }\n}\n\nexport const config = {\n  matcher: ['/'], // Match all routes\n}\n```\n\n\n**Explanation:**\n\nThe corrected code uses `new URL('/profile', req.url)` to construct an absolute URL.  `req.url` provides the base URL of the current request, and `/profile` is appended to create the complete, absolute URL for the redirect.  This ensures that the redirect works correctly regardless of the original request path.\n\n\n## External References\n\n* **Next.js Middleware Documentation:** [https://nextjs.org/docs/app/building-your-application/routing/middleware](https://nextjs.org/docs/app/building-your-application/routing/middleware)\n* **NextResponse Documentation:** [https://nextjs.org/docs/api-reference/next/server#nextresponse](https://nextjs.org/docs/api-reference/next/server#nextresponse)\n* **URL API (MDN):** [https://developer.mozilla.org/en-US/docs/Web/API/URL](https://developer.mozilla.org/en-US/docs/Web/API/URL)\n\n\n## Explanation of the solution:\n\nThe core issue stems from the context in which middleware operates.  It runs before the client-side routing happens.  Therefore, a simple relative path like `/profile` lacks the context of the base URL.  By using `new URL('/profile', req.url)`, we explicitly create a fully qualified URL that's understandable to the middleware layer.  This ensures the redirect consistently targets the correct location within your Next.js application.\n\n\nCopyrights (c) OpenRockets Open-source Network. Free to use, copy, share, edit or publish.\n","number":917,"title":"Next.js Middleware: Handling `Error: Only absolute URLs are supported`"}]
